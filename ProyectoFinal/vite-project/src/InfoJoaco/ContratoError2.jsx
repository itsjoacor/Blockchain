// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;


/// @title MinteoCondicionalSimple
/// @notice Permite mintear un NFT si la wallet que llama tiene al menos 1 NFT en el contrato pasado por parÃ¡metro

interface ICustomERC1155 {
    function balanceOf(address account, uint256 id) external view returns (uint256);
}

contract MinteoCondicionalSimple {
    uint256 public currentTokenId = 0;

    struct Metadata {
        string titulo;
        string descripcion;
        string nombre;
        string fecha;
        string imageUrl;
    }

    mapping(uint256 => Metadata) public metadatas;
    mapping(address => mapping(uint256 => uint256)) public balances;

    event TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value);

    /// @dev Error personalizado que puede ser capturado en el frontend
    error WalletNoCalifica();

    constructor() {}

    function mintConMetadataCondicional(
        address to,
        address contratoVerificacion,
        string memory titulo,
        string memory descripcion,
        string memory nombre,
        string memory fecha,
        string memory imageUrl
    ) public {
        ICustomERC1155 contrato = ICustomERC1155(contratoVerificacion);

        bool tieneAlMenosUno = false;

        for (uint256 id = 0; id < 100; id++) {
            try contrato.balanceOf(msg.sender, id) returns (uint256 balance) {
                if (balance > 0) {
                    tieneAlMenosUno = true;
                    break;
                }
            } catch {
                continue;
            }
        }

        if (!tieneAlMenosUno) {
            revert WalletNoCalifica();
        }

        uint256 tokenId = currentTokenId;
        balances[to][tokenId] = 1;

        metadatas[tokenId] = Metadata({
            titulo: titulo,
            descripcion: descripcion,
            nombre: nombre,
            fecha: fecha,
            imageUrl: imageUrl
        });

        emit TransferSingle(msg.sender, address(0), to, tokenId, 1);
        currentTokenId++;
    }

    function getMetadata(uint256 tokenId) public view returns (
        string memory titulo,
        string memory descripcion,
        string memory nombre,
        string memory fecha,
        string memory imageUrl
    ) {
        Metadata memory data = metadatas[tokenId];
        return (
            data.titulo,
            data.descripcion,
            data.nombre,
            data.fecha,
            data.imageUrl
        );
    }

    function uri(uint256 tokenId) public view returns (string memory) {
        return string(abi.encodePacked(
            "data:application/json;utf8,{\"name\":\"NFT #",
            toString(tokenId),
            "\",\"description\":\"On-chain metadata NFT\",",
            "\"image\":\"", metadatas[tokenId].imageUrl, "\"}"
        ));
    }

    function toString(uint256 value) internal pure returns (string memory) {
        if (value == 0) return "0";
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }
}

ADD: 0x020a378a2eb76772A07a841A22f7526bcA781147

ABI:
[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "contratoVerificacion",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "titulo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "descripcion",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "nombre",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "fecha",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "imageUrl",
				"type": "string"
			}
		],
		"name": "mintConMetadataCondicional",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "WalletNoCalifica",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "TransferSingle",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "balances",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "currentTokenId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "getMetadata",
		"outputs": [
			{
				"internalType": "string",
				"name": "titulo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "descripcion",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "nombre",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "fecha",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "imageUrl",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "metadatas",
		"outputs": [
			{
				"internalType": "string",
				"name": "titulo",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "descripcion",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "nombre",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "fecha",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "imageUrl",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "uri",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]




60806040526000805534801561001457600080fd5b506118c5806100246000396000f3fe608060405234801561001057600080fd5b50600436106100615760003560e01c80629a9b7b146100665780630e89341c146100845780638fbf70a9146100b4578063a574cea4146100d0578063cbf1304d14610104578063e73496cd14610134575b600080fd5b61006e610168565b60405161007b9190610bf8565b60405180910390f35b61009e60048036038101906100999190610c53565b61016e565b6040516100ab9190610d10565b60405180910390f35b6100ce60048036038101906100c99190610ec5565b6101b6565b005b6100ea60048036038101906100e59190610c53565b61044b565b6040516100fb959493929190610ff3565b60405180910390f35b61011e60048036038101906101199190611069565b61077c565b60405161012b9190610bf8565b60405180910390f35b61014e60048036038101906101499190610c53565b6107a1565b60405161015f959493929190610ff3565b60405180910390f35b60005481565b606061017982610a7f565b600160008481526020019081526020016000206004016040516020016101a0929190611359565b6040516020818303038152906040529050919050565b60008690506000805b6064811015610269578273ffffffffffffffffffffffffffffffffffffffff1662fdd58e33836040518363ffffffff1660e01b81526004016102029291906113b8565b602060405180830381865afa92505050801561023c57506040513d601f19601f8201168201806040525081019061023991906113f6565b60015b15610256576000811115610254576001925050610269565b505b808061026190611452565b9150506101bf565b50806102a1576040517f8bca147b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000805490506001600260008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000838152602001908152602001600020819055506040518060a001604052808981526020018881526020018781526020018681526020018581525060016000838152602001908152602001600020600082015181600001908161034c9190611631565b5060208201518160010190816103629190611631565b5060408201518160020190816103789190611631565b50606082015181600301908161038e9190611631565b5060808201518160040190816103a49190611631565b509050508973ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f6284600160405161042092919061173e565b60405180910390a460008081548092919061043a90611452565b919050555050505050505050505050565b60608060608060606000600160008881526020019081526020016000206040518060a001604052908160008201805461048390611244565b80601f01602080910402602001604051908101604052809291908181526020018280546104af90611244565b80156104fc5780601f106104d1576101008083540402835291602001916104fc565b820191906000526020600020905b8154815290600101906020018083116104df57829003601f168201915b5050505050815260200160018201805461051590611244565b80601f016020809104026020016040519081016040528092919081815260200182805461054190611244565b801561058e5780601f106105635761010080835404028352916020019161058e565b820191906000526020600020905b81548152906001019060200180831161057157829003601f168201915b505050505081526020016002820180546105a790611244565b80601f01602080910402602001604051908101604052809291908181526020018280546105d390611244565b80156106205780601f106105f557610100808354040283529160200191610620565b820191906000526020600020905b81548152906001019060200180831161060357829003601f168201915b5050505050815260200160038201805461063990611244565b80601f016020809104026020016040519081016040528092919081815260200182805461066590611244565b80156106b25780601f10610687576101008083540402835291602001916106b2565b820191906000526020600020905b81548152906001019060200180831161069557829003601f168201915b505050505081526020016004820180546106cb90611244565b80601f01602080910402602001604051908101604052809291908181526020018280546106f790611244565b80156107445780601f1061071957610100808354040283529160200191610744565b820191906000526020600020905b81548152906001019060200180831161072757829003601f168201915b505050505081525050905080600001518160200151826040015183606001518460800151955095509550955095505091939590929450565b6002602052816000526040600020602052806000526040600020600091509150505481565b60016020528060005260406000206000915090508060000180546107c490611244565b80601f01602080910402602001604051908101604052809291908181526020018280546107f090611244565b801561083d5780601f106108125761010080835404028352916020019161083d565b820191906000526020600020905b81548152906001019060200180831161082057829003601f168201915b50505050509080600101805461085290611244565b80601f016020809104026020016040519081016040528092919081815260200182805461087e90611244565b80156108cb5780601f106108a0576101008083540402835291602001916108cb565b820191906000526020600020905b8154815290600101906020018083116108ae57829003601f168201915b5050505050908060020180546108e090611244565b80601f016020809104026020016040519081016040528092919081815260200182805461090c90611244565b80156109595780601f1061092e57610100808354040283529160200191610959565b820191906000526020600020905b81548152906001019060200180831161093c57829003601f168201915b50505050509080600301805461096e90611244565b80601f016020809104026020016040519081016040528092919081815260200182805461099a90611244565b80156109e75780601f106109bc576101008083540402835291602001916109e7565b820191906000526020600020905b8154815290600101906020018083116109ca57829003601f168201915b5050505050908060040180546109fc90611244565b80601f0160208091040260200160405190810160405280929190818152602001828054610a2890611244565b8015610a755780601f10610a4a57610100808354040283529160200191610a75565b820191906000526020600020905b815481529060010190602001808311610a5857829003601f168201915b5050505050905085565b606060008203610ac6576040518060400160405280600181526020017f30000000000000000000000000000000000000000000000000000000000000008152509050610bda565b600082905060005b60008214610af8578080610ae190611452565b915050600a82610af19190611796565b9150610ace565b60008167ffffffffffffffff811115610b1457610b13610d9a565b5b6040519080825280601f01601f191660200182016040528015610b465781602001600182028036833780820191505090505b5090505b60008514610bd357600182610b5f91906117c7565b9150600a85610b6e91906117fb565b6030610b7a919061182c565b60f81b818381518110610b9057610b8f611860565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600a85610bcc9190611796565b9450610b4a565b8093505050505b919050565b6000819050919050565b610bf281610bdf565b82525050565b6000602082019050610c0d6000830184610be9565b92915050565b6000604051905090565b600080fd5b600080fd5b610c3081610bdf565b8114610c3b57600080fd5b50565b600081359050610c4d81610c27565b92915050565b600060208284031215610c6957610c68610c1d565b5b6000610c7784828501610c3e565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610cba578082015181840152602081019050610c9f565b60008484015250505050565b6000601f19601f8301169050919050565b6000610ce282610c80565b610cec8185610c8b565b9350610cfc818560208601610c9c565b610d0581610cc6565b840191505092915050565b60006020820190508181036000830152610d2a8184610cd7565b905092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610d5d82610d32565b9050919050565b610d6d81610d52565b8114610d7857600080fd5b50565b600081359050610d8a81610d64565b92915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610dd282610cc6565b810181811067ffffffffffffffff82111715610df157610df0610d9a565b5b80604052505050565b6000610e04610c13565b9050610e108282610dc9565b919050565b600067ffffffffffffffff821115610e3057610e2f610d9a565b5b610e3982610cc6565b9050602081019050919050565b82818337600083830152505050565b6000610e68610e6384610e15565b610dfa565b905082815260208101848484011115610e8457610e83610d95565b5b610e8f848285610e46565b509392505050565b600082601f830112610eac57610eab610d90565b5b8135610ebc848260208601610e55565b91505092915050565b600080600080600080600060e0888a031215610ee457610ee3610c1d565b5b6000610ef28a828b01610d7b565b9750506020610f038a828b01610d7b565b965050604088013567ffffffffffffffff811115610f2457610f23610c22565b5b610f308a828b01610e97565b955050606088013567ffffffffffffffff811115610f5157610f50610c22565b5b610f5d8a828b01610e97565b945050608088013567ffffffffffffffff811115610f7e57610f7d610c22565b5b610f8a8a828b01610e97565b93505060a088013567ffffffffffffffff811115610fab57610faa610c22565b5b610fb78a828b01610e97565b92505060c088013567ffffffffffffffff811115610fd857610fd7610c22565b5b610fe48a828b01610e97565b91505092959891949750929550565b600060a082019050818103600083015261100d8188610cd7565b905081810360208301526110218187610cd7565b905081810360408301526110358186610cd7565b905081810360608301526110498185610cd7565b9050818103608083015261105d8184610cd7565b90509695505050505050565b600080604083850312156110805761107f610c1d565b5b600061108e85828601610d7b565b925050602061109f85828601610c3e565b9150509250929050565b600081905092915050565b7f646174613a6170706c69636174696f6e2f6a736f6e3b757466382c7b226e616d60008201527f65223a224e465420230000000000000000000000000000000000000000000000602082015250565b60006111106029836110a9565b915061111b826110b4565b602982019050919050565b600061113182610c80565b61113b81856110a9565b935061114b818560208601610c9c565b80840191505092915050565b7f222c226465736372697074696f6e223a224f6e2d636861696e206d657461646160008201527f7461204e4654222c000000000000000000000000000000000000000000000000602082015250565b60006111b36028836110a9565b91506111be82611157565b602882019050919050565b7f22696d616765223a220000000000000000000000000000000000000000000000600082015250565b60006111ff6009836110a9565b915061120a826111c9565b600982019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061125c57607f821691505b60208210810361126f5761126e611215565b5b50919050565b60008190508160005260206000209050919050565b6000815461129781611244565b6112a181866110a9565b945060018216600081146112bc57600181146112d157611304565b60ff1983168652811515820286019350611304565b6112da85611275565b60005b838110156112fc578154818901526001820191506020810190506112dd565b838801955050505b50505092915050565b7f227d000000000000000000000000000000000000000000000000000000000000600082015250565b60006113436002836110a9565b915061134e8261130d565b600282019050919050565b600061136482611103565b91506113708285611126565b915061137b826111a6565b9150611386826111f2565b9150611392828461128a565b915061139d82611336565b91508190509392505050565b6113b281610d52565b82525050565b60006040820190506113cd60008301856113a9565b6113da6020830184610be9565b9392505050565b6000815190506113f081610c27565b92915050565b60006020828403121561140c5761140b610c1d565b5b600061141a848285016113e1565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061145d82610bdf565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361148f5761148e611423565b5b600182019050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026114e77fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826114aa565b6114f186836114aa565b95508019841693508086168417925050509392505050565b6000819050919050565b600061152e61152961152484610bdf565b611509565b610bdf565b9050919050565b6000819050919050565b61154883611513565b61155c61155482611535565b8484546114b7565b825550505050565b600090565b611571611564565b61157c81848461153f565b505050565b5b818110156115a057611595600082611569565b600181019050611582565b5050565b601f8211156115e5576115b681611275565b6115bf8461149a565b810160208510156115ce578190505b6115e26115da8561149a565b830182611581565b50505b505050565b600082821c905092915050565b6000611608600019846008026115ea565b1980831691505092915050565b600061162183836115f7565b9150826002028217905092915050565b61163a82610c80565b67ffffffffffffffff81111561165357611652610d9a565b5b61165d8254611244565b6116688282856115a4565b600060209050601f83116001811461169b5760008415611689578287015190505b6116938582611615565b8655506116fb565b601f1984166116a986611275565b60005b828110156116d1578489015182556001820191506020850194506020810190506116ac565b868310156116ee57848901516116ea601f8916826115f7565b8355505b6001600288020188555050505b505050505050565b6000819050919050565b600061172861172361171e84611703565b611509565b610bdf565b9050919050565b6117388161170d565b82525050565b60006040820190506117536000830185610be9565b611760602083018461172f565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006117a182610bdf565b91506117ac83610bdf565b9250826117bc576117bb611767565b5b828204905092915050565b60006117d282610bdf565b91506117dd83610bdf565b92508282039050818111156117f5576117f4611423565b5b92915050565b600061180682610bdf565b915061181183610bdf565b92508261182157611820611767565b5b828206905092915050565b600061183782610bdf565b915061184283610bdf565b925082820190508082111561185a57611859611423565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fdfea26469706673582212200b49fd65bc8ff6d4e661350cbc1215496365371f61a62cf6da411a29f1bc7a7364736f6c63430008140033